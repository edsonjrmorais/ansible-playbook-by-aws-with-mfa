# Setup
## Step 1
| Step 1                                | Preparing environment (considering WSL OS Ubuntu 20.04)                               |
| :---:                                 | :---:                                                                                 |
| To check the installed Ubuntu Version | `lsb_release -a`                                                                      |
| Update Ubuntu                         | `sudo apt update && sudo apt upgrade`                                                 |
| Install Ansible                       | `sudo apt install ansible`                                                            |
| Install Pip                           | `sudo apt install python3-pip`                                                        |
| Install Boto                          | `pip3 install boto boto3 botocore`                                                    |
| Install Ansible Modules               | `ansible-galaxy collection install amazon.aws community.aws community.general`        |
| Install Docker Python SDK             | `sudo pip3 install docker`                                                            |
| (Optional) Install Ansible Lint       | `sudo apt install ansible-lint`                                                       |
| (Optional) Install AWS Cli V1         | `sudo pip3 install --upgrade awscli`                                                  |

## Step 2
| Step 2                            | Make GitHub Clone of the repository                                                |
| :---:                             | :---:                                                                              |
| Download Repo (if not already)    | `git clone https://github.com/edsonjrmorais/ansible-playbook-by-aws-with-mfa.git`  |

## Step 3
| Step 3                                                                                | Configue your local AWS credentials and config files at the folder [~/.aws] in your computer     |
| :---:                                                                                 | :---:                                                                                            |
| Create `~/.aws` folder                                                                | `mkdir ~/.aws`                                                                                   |
| Replace your current content file [~/.aws/config] by content file [config]            | `cp config/example/config ~/.aws/config`                                                         |
| Replace your current content file [~/.aws/credentials] by content file [credentials]  | `cp config/example/credentials ~/.aws/credentials`                                               |
| Guarantee to put your Access and Secret key                                           | `nano ~/.aws/credentials`                                                                        |

# Instructions - Executing the Playbook:
Command to run the playbook:
```sh
ansible-playbook main.yaml -i inventory --tags "product-aws-account-bootstrap" --extra-vars "devops_operator=@devops_operator_AWS_USER aws_team_account=@aws_team_account_VALUES devops_operator_mfa_token=@devops_operator_MFA_TOKEN"
```

Alternativelly, you can use make to run different or multiple playbook combinations:
```sh
devops_operator=@devops_operator_AWS_USER aws_team_account=@aws_team_account_VALUES mfa_token=@devops_operator_MFA_TOKEN make product-aws-account-bootstrap
```

|Command Parameter              | Descripyion                                                           		  |
| :---:                         | :---:                                                                 		  |
| @devops_operator_AWS_USER     | The aws user name, according to the AWS Master Account, that will execute this playbook |
| @devops_operator_MFA_TOKEN    | The MFA Token of @devops_operator_AWS_USER                            		  |
| @aws_team_account_VALUES      | The AWS Profile Name according the file [config] inside path ~/.aws, see below:         |
	[
        "env-dev",
        "env-qa",
        "env-prd"
	]

## AWS Test interactions using the Access and Secret Key generated by Ansible
### configuring your environment
aws configure [access_key = @generated-by-ansible; secret_key = @generated-by-ansible; region = eu-west-1 ; format = json]

### Testing your AWS Access and Secret Key [listing your bucket]
aws s3 ls s3://bkt-env-dev

### Testing your AWS Access and Secret Key [creating a subfolder in your bucket]
aws s3api put-object --bucket bkt-env-dev --key my-sub-folder/

### Testing your AWS Access and Secret Key [storing object in your bucket]
aws s3 cp testing-aws-team-access-key.txt s3://bkt-env-dev/my-sub-folder/testing-aws-team-access-key.txt --acl public-read

### Testing your AWS Access and Secret Key [deleting object in your bucket]
aws s3 rm s3://bkt-env-dev/my-sub-folder/testing-aws-team-access-key.txt

### Testing your AWS Access and Secret Key [deleting folder in your bucket]
aws s3 rm s3://bkt-env-dev/my-sub-folder --recursive
